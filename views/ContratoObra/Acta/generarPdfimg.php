<?php
$idContrato = $_GET["id"];
$NombreContratistas = $_GET["nombre"];
$NombreSupervisor = $_GET["NombreSupervisor"];
$numInforme = $_GET["numInforme"];
$fechaInforme = $_GET["fechaInforme"];
$idActa = $_GET["idActa"];
$minimoMensual = 908526;
$minimoDia = $minimoMensual /30;

include('../../../db.php');

//extraccion información del contrato
$query= "SELECT * FROM contrato  WHERE contrato.id = $idContrato";
$result = mysqli_query($conexion,$query) or die("fallo en la conexión");
$row = mysqli_fetch_array($result);

$query2= "SELECT * FROM usuario  WHERE id = $row[idSupervisor]";
$result2 = mysqli_query($conexion,$query2) or die("fallo en la conexión");
$rowSupervisor = mysqli_fetch_array($result2);

$query3= "SELECT * FROM usuario  WHERE id = $row[idUsuario]";
$result3 = mysqli_query($conexion,$query3) or die("fallo en la conexión");
$rowContratista = mysqli_fetch_array($result3);

//Extraccion de los registros de adiciones y suspensiones
$query4= "SELECT * FROM adicion_suspension WHERE idContrato = $idContrato";
$result4 = mysqli_query($conexion,$query4);


//extraccion proyeccion
$query5= "SELECT * FROM proyeccion_contractual WHERE idContrato = $idContrato and prioridad = 1";
$result5 = mysqli_query($conexion,$query5);

       //Extraccion de los alcances
$query6= "SELECT * FROM alcance WHERE idContrato = $idContrato";
$result6 = mysqli_query($conexion,$query6);

//Extracción de las actuales actas 
$query7= "SELECT * FROM acta  WHERE idContrato = $idContrato AND num_informe <= $numInforme ";
$result7 = mysqli_query($conexion,$query7) or die("fallo en la conexión ");
$arrayActa = array();





//Guarda los datos de las plantillas pagas y el acumulado del las actas creadas 
//sirve para mostrar en la proyeccion las actas que ya se han hecho
while($filas7=mysqli_fetch_assoc($result7)){
    $arrayActa[] = $filas7['acumulado'];
    $arrayActa[] = $filas7['fechaPlanilla'];
    $arrayActa[] = $filas7['numPlanilla'];
    $arrayActa[] = $filas7['valorPlanilla'];
}
/*for($i=0; $i < count($arrayActa); $i += 4){
    echo "<br>". $arrayActa[$i];
}*/
//Extracción de la proyeccion actual  correspondiente al acta a pagar
$query8= "SELECT * FROM proyeccion_contractual WHERE idContrato = $idContrato and num_acta = $numInforme ";
$result8 = mysqli_query($conexion,$query8) or die("fallo en la conexión");
$filas8 = mysqli_fetch_array($result8);

//Extracción del  actual acta hecha 
$query9= "SELECT * FROM acta  WHERE id = $idActa  ";
$result9 = mysqli_query($conexion,$query9) or die("fallo en la conexión acta");
$filas9 = mysqli_fetch_array($result9);

require('../fpdf.php');


$pdf=new FPDF();
$pdf->AddPage();

//Logo
$pdf->Image('../../../public/img/informeActividades.png',10,2,200);
$pdf->Ln(12);





//FECHA 
$pdf->SetFont('Arial','B',6);
$pdf->Cell(56, 5, utf8_decode('Fecha de Informe'),1,0,'C',0);
// Acta N 
$pdf->Cell(56, 5, utf8_decode('Acta N° '),1,0,'C',0);
//  Modalidad Contractual
$pdf->Cell(80, 5, utf8_decode('Modalidad Contractual '),1,1,'C',0);


 //-----------------------------------------DATOS--------------------------------------------------------
 //FECHA 
$pdf->SetFont('Arial','B',5);
$pdf->Cell(56, 5, utf8_decode($fechaInforme ),1,0,'C',0);
//Acta N 
$pdf->Cell(56, 5, utf8_decode($numInforme),1,0,'C',0);
// Modalidad Contractual
$pdf->Cell(80, 5, utf8_decode($row['modalidad']),1,1,'C',0);

//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------


//informe de actividades
$pdf->SetFont('Arial','B',8);
$pdf->Cell(192, 5, '1.Informe de actividades',1,1,'C',0);

//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//Registro PPTAL 
$pdf->SetFont('Arial','B',6);
$pdf->Cell(50, 5, utf8_decode('Registro PPTAL'),1,0,'C',0);
//  CDP  
$pdf->Cell(46, 5, utf8_decode('CDP'),1,0,'C',0);
//Año
$pdf->Cell(46, 5, utf8_decode('Año'),1,0,'C',0);
//Contrato N° 
$pdf->Cell(50, 5, utf8_decode('Contrato N°'),1,1,'C',0);


 //-----------------------------------------DATOS--------------------------------------------------------

 //Registro PPTAL 
$pdf->SetFont('Arial','B',5);
$pdf->Cell(50, 5, utf8_decode($row['registro_pptal']),1,0,'C',0);
 //  CDP  
$pdf->Cell(46, 5, utf8_decode($row['disp_presupuestal']),1,0,'C',0);
//Año
$pdf->Cell(46, 5, utf8_decode($row['years']),1,0,'C',0);
//Contrato N° 
$pdf->Cell(50, 5, utf8_decode($row['num_contrato']),1,1,'C',0);

//--//------------------------------------------------------------------//FILA2//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA2//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA2//------------------------------------------------------------
//  Rubro 
$pdf->SetFont('Arial','B',6);
$pdf->Cell(192, 5, utf8_decode('Rubro'),1,1,'C',0);
//-----------------------------------------DATOS--------------------------------------------------------

//  Rubro 
$pdf->SetFont('Arial','B',5);
$pdf->Cell(192, 5, utf8_decode($row['rubro']),1,1,'C',0);



//--//------------------------------------------------------------------//FILA4//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA4//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA4//------------------------------------------------------------
//Contratante
$pdf->SetFont('Arial','B',6);
$pdf->Cell(85, 5, utf8_decode('Contratante'),1,0,'C',0);
//  Nit  
$pdf->Cell(27, 5, utf8_decode('Nit'),1,0,'C',0);
//Dirección
$pdf->Cell(80, 5, utf8_decode('Dirección'),1,1,'C',0);

 //-----------------------------------------DATOS--------------------------------------------------------

 //Registro PPTAL 
$pdf->SetFont('Arial','B',5);
$pdf->Cell(85, 5, utf8_decode('Instituto De Desarrollo Municpal de Dosquebras'),1,0,'C',0);
 //  Nit  
$pdf->Cell(27, 5, utf8_decode('816005795-1'),1,0,'C',0);
//Dirección
$pdf->Cell(80, 5, utf8_decode('Calle 50 NRO 14 -  56 Barrio LOS Naranjos'),1,1,'C',0);



//--//------------------------------------------------------------------//FILA5//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA5//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA5//------------------------------------------------------------
//Ordenador del Gasto
$pdf->SetFont('Arial','B',6);
$pdf->Cell(65, 5, utf8_decode('Ordenador del Gasto'),1,0,'C',0);
//Identificacion  
$pdf->Cell(57, 5, utf8_decode('Ident'),1,0,'C',0);
//Cargo
$pdf->Cell(70, 5, utf8_decode('Cargo'),1,1,'C',0);


 //-----------------------------------------DATOS--------------------------------------------------------

 //Ordenador del Gasto
$pdf->SetFont('Arial','B',5);
$pdf->Cell(65, 5, utf8_decode('LUIS ERNESTO VALENCIA RAMIREZ'),1,0,'C',0);
//Identificacion  
$pdf->Cell(57, 5, utf8_decode('1858078'),1,0,'C',0);
//Cargo
$pdf->Cell(70, 5, utf8_decode('Directo general'),1,1,'C',0);


//--//------------------------------------------------------------------//FILA6//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA6//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA6//------------------------------------------------------------
//Supervisor
$pdf->SetFont('Arial','B',6);
$pdf->Cell(52, 5, utf8_decode('Supervisor'),1,0,'C',0);
//Identificacion  
$pdf->Cell(25, 5, utf8_decode('Ident '),1,0,'C',0);
//Cargo
$pdf->Cell(45, 5, utf8_decode('Cargo'),1,0,'C',0);
//Fecha Delegación
$pdf->Cell(37, 5, utf8_decode('Fecha Delegación'),1,0,'C',0);
//N° Delegación
$pdf->Cell(33, 5, utf8_decode('N° Delegación'),1,1,'C',0);

 //-----------------------------------------DATOS--------------------------------------------------------

 //Supervisor
$pdf->SetFont('Arial','B',5);
$pdf->Cell(52, 5, utf8_decode($NombreSupervisor),1,0,'C',0);
 //Identificacion  
$pdf->Cell(25, 5, utf8_decode($rowSupervisor['cedula']),1,0,'C',0);
//Cargo
$pdf->Cell(45, 5, utf8_decode($rowSupervisor['cargo']),1,0,'C',0);
//Fecha Delegación
$pdf->Cell(37, 5, utf8_decode($row['fecha_delegacion']),1,0,'C',0);
//N° Delegación
$pdf->Cell(33, 5, utf8_decode($row['num_delegacion']),1,1,'C',0);

//--//------------------------------------------------------------------//FILA7//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA7//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA7//------------------------------------------------------------
//Contratista
$pdf->SetFont('Arial','B',6);
$pdf->Cell(52, 5, utf8_decode('Contratista'),1,0,'C',0);
//Identificacion  
$pdf->Cell(25, 5, utf8_decode('Ident '),1,0,'C',0);
//Profesión
$pdf->Cell(45, 5, utf8_decode('Profesión'),1,0,'C',0);
//Dirección
$pdf->Cell(70, 5, utf8_decode('Dirección'),1,1,'C',0);


 //-----------------------------------------DATOS--------------------------------------------------------

 //Contratista
$pdf->SetFont('Arial','B',5);
$pdf->Cell(52, 5, utf8_decode($NombreContratistas),1,0,'C',0);
 //Identificacion  
$pdf->Cell(25, 5, utf8_decode($rowContratista['cedula']),1,0,'C',0);
$pdf->Cell(45, 5, utf8_decode($rowContratista['profesion']),1,0,'C',0);
//Dirección
$pdf->Cell(70, 5, utf8_decode($rowContratista['direccion']),1,1,'C',0);


//--//------------------------------------------------------------------//FILA8//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA8//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA8//------------------------------------------------------------
//Tipo de persona
$pdf->SetFont('Arial','B',6);
$pdf->Cell(52, 5, utf8_decode('Tipo de persona'),1,0,'C',0);
//Responsable de iva 
$pdf->Cell(35, 5, utf8_decode('Resp de iva '),1,0,'C',0);
//Telefono
$pdf->Cell(35, 5, utf8_decode('Telefono'),1,0,'C',0);
//Correo
$pdf->Cell(70, 5, utf8_decode('Correo'),1,1,'C',0);


 //-----------------------------------------DATOS--------------------------------------------------------

//Tipo de persona
$pdf->SetFont('Arial','B',5);
$pdf->Cell(52, 5, utf8_decode($rowContratista['tipo_persona']),1,0,'C',0);
//Responsable de iva
$pdf->Cell(35, 5, utf8_decode($rowContratista['resp_iva']),1,0,'C',0);
//Telefono
$pdf->Cell(35, 5, utf8_decode($rowContratista['telefono']),1,0,'C',0);
//Correo
$pdf->Cell(70, 5, utf8_decode($rowContratista['correo']),1,1,'C',0);

//--//------------------------------------------------------------------//FILA9//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA9//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA9//------------------------------------------------------------
//Duración
$pdf->SetFont('Arial','B',6);
$pdf->Cell(33, 5, utf8_decode('Duración'),1,0,'C',0);
//Valor
$pdf->Cell(54, 5, utf8_decode('Valor'),1,0,'C',0);
//Fecha de Inicio
$pdf->Cell(53, 5, utf8_decode('Fecha de Inicio'),1,0,'C',0);
//Fecha de Fin
$pdf->Cell(52, 5, utf8_decode('Fecha de Fin'),1,1,'C',0);

 //-----------------------------------------DATOS--------------------------------------------------------

//Duración
$pdf->SetFont('Arial','B',5);
$pdf->Cell(33, 5, utf8_decode($row['duracion']),1,0,'C',0);
//Valor
$pdf->Cell(54, 5, utf8_decode($row['valor_contrato']),1,0,'C',0);
//Fecha de Inicio
$pdf->Cell(53, 5, utf8_decode($row['fecha_ini']),1,0,'C',0);
//Fecha de Fin
$pdf->Cell(52, 5, utf8_decode($row['fecha_fin']),1,1,'C',0);
$pdf->Ln(4);

//--//------------------------------------------------------------------//FILA11//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA11//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA11//------------------------------------------------------------
//Objeto
$pdf->MultiCell(192, 3, utf8_decode('Objeto: '.$row['objeto']), 1, 'J');
//Forma de pago
$pdf->MultiCell(192, 3, utf8_decode('Forma de pago: '.$row['forma_pago']),1,'J');
//Entregables
$pdf->MultiCell(192, 3, utf8_decode('Forma de pago: '.$row['entregables']),1,'J');
//Observación
$pdf->MultiCell(192, 3, utf8_decode('Observaciones: '.$row['observaciones']), 1, 1);
$pdf->Ln(4);





//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------


//---------------------------------------------2.Seguridad Social E Impuestos--------------------------------------------------------
//informe de actividades
$pdf->SetFont('Arial','B',8);
$pdf->Cell(192, 5, '2.Seguridad Social E Impuestos',1,1,'C',0);

//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//Item
$pdf->SetFont('Arial','B',5);
$pdf->Cell(30, 5, utf8_decode('Item'),1,0,'C',0);
//%
$pdf->Cell(6, 5, utf8_decode('%'),1,0,'C',0);
//Tipo
$pdf->Cell(12, 5, utf8_decode('Tipo'),1,0,'C',0);
//Valor Total
$pdf->Cell(18, 5, utf8_decode('Valor Total'),1,0,'C',0);
//Valor Mes
$pdf->Cell(18, 5, utf8_decode('Valor Mes'),1,0,'C',0);
//Valor Dia 
$pdf->Cell(18, 5, utf8_decode('Valor Dia'),1,0,'C',0);
//Dias  a pagar
$pdf->Cell(18, 5, utf8_decode('Dias  a pagar'),1,0,'C',0);
//En el acta 
$pdf->Cell(18, 5, utf8_decode('En el acta'),1,0,'C',0);
//Entidad Afiliación
$pdf->Cell(18, 5, utf8_decode('Entidad Afiliación'),1,0,'C',0);
//Fecha Afiliación
$pdf->Cell(18, 5, utf8_decode('Fecha Afiliación'),1,0,'C',0);
//Día Habil Pago
$pdf->Cell(18, 5, utf8_decode('Día Habil Pago'),1,1,'C',0);



 //-----------------------------------------DATOS--------------------------------------------------------
 $consulta2= "SELECT * FROM `contrato_retencion` WHERE idContrato = $idContrato";
 $resultado2 = mysqli_query($conexion,$consulta2);
 $rowsImpuestos = mysqli_num_rows($resultado2);
 
 $cont = 1;
 $sumBaseTotal = 0;
 $sumBaseMes = 0;
 $sumBaseDia = 0;
 $sumActa = 0;
 while($idRetencion =mysqli_fetch_array($resultado2)){ 

    $consulta3= "SELECT * FROM `retencion` WHERE id = $idRetencion[idRetencion] ";
    $resultado3 = mysqli_query($conexion,$consulta3);
    $itemRetencion =mysqli_fetch_array($resultado3); 

    $pdf->Cell(30, 5, utf8_decode($itemRetencion['nombre']),1,0,'C',0);
    //%
    $pdf->Cell(6, 5, utf8_decode($itemRetencion['porcentaje']),1,0,'C',0);
    //Tipo
    $pdf->Cell(12, 5, utf8_decode($itemRetencion['tipo']),1,0,'C',0);
    ///para sacar el valor total
    if($cont == 1){
           
        $baseCotizacionTotal = round(($itemRetencion['porcentaje'] / 100) * ($row['valor_contrato']));
        if($baseCotizacionTotal < ($minimoDia * $row['duracion'])){
             $baseCotizacionTotal = $minimoDia * $row['duracion'];

        }
        //Valor Total
        $pdf->Cell(18, 5, utf8_decode($baseCotizacionTotal ),1,0,'C',0);
   }else{
        $baseValor = round(($itemRetencion['porcentaje'] / 100) * $baseCotizacionTotal);
        $pdf->Cell(18, 5, utf8_decode($baseValor),1,0,'C',0);
        $sumBaseTotal = $sumBaseTotal + round(($itemRetencion['porcentaje'] / 100) * $baseCotizacionTotal);
        
   }
   ///para sacar el valor mes
   if($cont == 1){
        $baseCotizacion = round(($itemRetencion['porcentaje'] / 100) * ($row['valorMes']));
        //$baseCotizacion = $baseCotizacion / $row['num_actas'];
        if($baseCotizacion < $minimoMensual){
            $baseCotizacion = $minimoMensual;
        }
        //Valor Mes
        $pdf->Cell(18, 5, utf8_decode($baseCotizacion),1,0,'C',0);
    }else{
        $baseValor2 = round(($itemRetencion['porcentaje'] / 100) * $baseCotizacion );
        //Valor Mes
        $pdf->Cell(18, 5, utf8_decode($baseValor2),1,0,'C',0);
        $sumBaseMes = $sumBaseMes + round(($itemRetencion['porcentaje'] / 100) * $baseCotizacion) ;
    }
    ///para sacar el valor dia
    if($cont == 1){
        $baseCotizacionDia = round($baseCotizacion / 30);
        //Valor Dia 
        $pdf->Cell(18, 5, utf8_decode($baseCotizacionDia),1,0,'C',0);
   }else{
        $baseValor3 = round(($itemRetencion['porcentaje'] / 100) * $baseCotizacionDia) ;
        //Valor Dia 
        $pdf->Cell(18, 5, utf8_decode($baseValor3),1,0,'C',0);
        $sumBaseDia = $sumBaseDia + round(($itemRetencion['porcentaje'] / 100) * $baseCotizacionDia) ;
   }
    //Dias  a pagar
    $pdf->Cell(18, 5, utf8_decode($filas8['dias']),1,0,'C',0);

    if($cont == 1){
          //En el acta 
          $pdf->Cell(18, 5, utf8_decode($baseCotizacionTotal),1,0,'C',0); 
    }else{ 
        
        $baseCotizacionTotal2 = round(($itemRetencion['porcentaje'] / 100) * $baseCotizacionTotal);
        //En el acta 
        $pdf->Cell(18, 5, utf8_decode($baseCotizacionTotal2),1,0,'C',0);
        $sumActa  = $sumActa + round(($itemRetencion['porcentaje'] / 100) * $baseCotizacionTotal) ;
    }
    //Entidad Afiliación
    $pdf->Cell(18, 5, utf8_decode($row['salud']),1,0,'C',0);
    //Fecha Afiliación
    $pdf->Cell(18, 5, utf8_decode($row['fecha_activacion']),1,0,'C',0);
    //Día Habil Pago
    $pdf->Cell(18, 5, utf8_decode($row['dia_habil_pago']),1,1,'C',0);
    //para agregar totales 
    if($cont == 4 || $cont == $rowsImpuestos ){
        $baseCotizacionTotal =  $row['valor_contrato'] ;  
        $baseCotizacion = $row['valorDia'] * 30;  
        $baseCotizacionDia = $row['valorDia'] ;

        $pdf->Cell(48, 5, utf8_decode('Total'),1,0,'C',0);
        $pdf->Cell(18, 5, utf8_decode($sumBaseTotal),1,0,'C',0);
        $pdf->Cell(18, 5, utf8_decode($sumBaseMes),1,0,'C',0);
        $pdf->Cell(18, 5, utf8_decode($sumBaseDia),1,0,'C',0);
        $pdf->Cell(18, 5, utf8_decode(''),1,0,'C',0);
        $pdf->Cell(18, 5, utf8_decode($sumActa),1,0,'C',0);
        $pdf->Cell(18, 5, utf8_decode(''),1,0,'C',0);
        $pdf->Cell(18, 5, utf8_decode(''),1,0,'C',0);
        $pdf->Cell(18, 5, utf8_decode(''),1,1,'C',0);

        $sumBaseTotal =0; $sumBaseMes =0; $sumBaseDia =0; $sumActa = 0;
    } 
    $cont++;
} 
$pdf->Ln(4);
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------


//---------------------------------------------3.Proyeccion contractual--------------------------------------------------------


//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------

//informe de actividades
$pdf->SetFont('Arial','B',8);
$pdf->Cell(192, 5, '3.Proyeccion contractual',1,1,'C',0);

//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//#
$pdf->SetFont('Arial','B',5);
$pdf->Cell(4, 5, utf8_decode('#'),1,0,'C',0);
//Periodo Inicio
$pdf->Cell(17, 5, utf8_decode('Periodo Inicio'),1,0,'C',0);
//Periodo Fin
$pdf->Cell(17, 5, utf8_decode('Periodo Fin'),1,0,'C',0);
//Dias
$pdf->Cell(14, 5, utf8_decode('Dias'),1,0,'C',0);
//Valor Dia 
$pdf->Cell(17, 5, utf8_decode('Valor Dia'),1,0,'C',0);
//Valor  
$pdf->Cell(17, 5, utf8_decode('Valor'),1,0,'C',0);
//Estado 
$pdf->Cell(17, 5, utf8_decode('Estado'),1,0,'C',0);
//Acumulado  
$pdf->Cell(17, 5, utf8_decode('Acumulado '),1,0,'C',0);
//Saldo 
$pdf->Cell(17, 5, utf8_decode('Saldo'),1,0,'C',0);
//Fecha de pago planilla 
$pdf->Cell(21, 5, utf8_decode('Fecha de pago planilla '),1,0,'C',0);
//Planilla 
$pdf->Cell(17, 5, utf8_decode('Planilla '),1,0,'C',0);
//Valor Pagado
$pdf->Cell(17, 5, utf8_decode('Valor'),1,1,'C',0);


 //-----------------------------------------DATOS--------------------------------------------------------
 $cont = 1;
 while($filas5=mysqli_fetch_array($result5)){
    //#
    $pdf->SetFont('Arial','B',5);
    $pdf->Cell(4, 5, utf8_decode($cont),1,0,'C',0);
    //Periodo Inicio
    $pdf->Cell(17, 5, utf8_decode($filas5['periodo_ini']),1,0,'C',0);
    //Periodo Fin
    $pdf->Cell(17, 5, utf8_decode($filas5['periodo_fin']),1,0,'C',0);
    //Dias
    $pdf->Cell(14, 5, utf8_decode(round($filas5['dias'])),1,0,'C',0);
    //Valor Dia 
    $pdf->Cell(17, 5, utf8_decode(round($filas5['valor_dia'])),1,0,'C',0);
    //Valor  
    $pdf->Cell(17, 5, utf8_decode(round($filas5['valor_mes'])),1,0,'C',0);
    //Estado 
    $pdf->Cell(17, 5, utf8_decode('Pendiente'),1,0,'C',0);
    //Acumulado  
    $pdf->Cell(17, 5, utf8_decode(round($filas5['acomulado'])),1,0,'C',0);
    //Saldo 
    $pdf->Cell(17, 5, utf8_decode(round($filas5['saldo'])),1,0,'C',0);

    //---------------------------------------------------------------------------------------------------------------------------------------------------------------------
    //-------------MUESTRA LA INFORMACION DE LAs PLANILLA YA REALIZADAS--------------------------------------------------------------------------------------------------------------------------------------------------------
    //---------------------------------------------------------------------------------------------------------------------------------------------------------------------
    $sinData = true;
    for($i=0; $i < count($arrayActa); $i += 4){
        if($arrayActa[$i] == $filas5['acomulado']){
            $sinData = false;

            //Fecha de pago planilla 
            $pdf->Cell(21, 5, utf8_decode($arrayActa[$i+1] ),1,0,'C',0);
            //Planilla 
            $pdf->Cell(17, 5, utf8_decode($arrayActa[$i+2] ),1,0,'C',0);
            //Valor Pagado
            $pdf->Cell(17, 5, utf8_decode($arrayActa[$i+3] ),1,1,'C',0);
        }
    }
    if($sinData){
         //Fecha de pago planilla 
        $pdf->Cell(21, 5, utf8_decode(''),1,0,'C',0);
        //Planilla 
        $pdf->Cell(17, 5, utf8_decode(''),1,0,'C',0);
        //Valor Pagado
        $pdf->Cell(17, 5, utf8_decode(''),1,1,'C',0);
    }
    $cont++;
 }
 $pdf->AddPage();
// $pdf->Ln(39);
 //--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------


//---------------------------------------------4.Informe de Actividades--------------------------------------------------------------


//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//-------------------//informe de actividades

//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//Logo
$pdf->Image('../../../public/img/contratista.jpg',10,2,192);


$pdf->AddPage();
$pdf->Cell(192, 5, utf8_decode('Observaciones:'.$filas9['observaciones']),1,1,'',0);
$pdf->Ln(4);



 //--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------


//---------------------------------------------5.Novedades--------------------------------------------------------


//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------
//---------------------------------------------------//----------------------------------------------------------------------------------------------//-----------------


//informe de actividades
$pdf->SetFont('Arial','B',8);
$pdf->Cell(192, 5, '5.Novedades',1,1,'C',0);

//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------
//--//------------------------------------------------------------------//FILA1//------------------------------------------------------------

$pdf->SetFont('Arial','B',5);
//Periodo Inicio
$pdf->Cell(21, 5, utf8_decode('Periodo Inicio'),1,0,'C',0);
//Periodo Fin
$pdf->Cell(21, 5, utf8_decode('Periodo Fin'),1,0,'C',0);
//Dias
$pdf->Cell(21, 5, utf8_decode('Dias'),1,0,'C',0);
//Valor  
$pdf->Cell(21, 5, utf8_decode('Valor'),1,0,'C',0);
//Acumulado  
$pdf->Cell(21, 5, utf8_decode('Acumulado '),1,0,'C',0);
//Saldo 
$pdf->Cell(21, 5, utf8_decode('Saldo'),1,0,'C',0);
//Fecha de pago planilla 
$pdf->Cell(24, 5, utf8_decode('Fecha de pago planilla '),1,0,'C',0);
//Planilla 
$pdf->Cell(21, 5, utf8_decode('Planilla '),1,0,'C',0);
//Valor Pagado
$pdf->Cell(21, 5, utf8_decode('Valor'),1,1,'C',0);


 //-----------------------------------------DATOS--------------------------------------------------------

//#
$pdf->SetFont('Arial','B',5);
//Periodo Inicio
$pdf->Cell(21, 5, utf8_decode($filas9['fecha_ini']),1,0,'C',0);
//Periodo Fin
$pdf->Cell(21, 5, utf8_decode($filas9['fecha_fin']),1,0,'C',0);
//Dias
$pdf->Cell(21, 5, utf8_decode(round($filas9['diasPagos'])),1,0,'C',0);
//Valor  
$pdf->Cell(21, 5, utf8_decode(round($filas9['valor'])),1,0,'C',0);
//Acumulado  
$pdf->Cell(21, 5, utf8_decode(round($filas9['acumulado'])),1,0,'C',0);
//Saldo 
$pdf->Cell(21, 5, utf8_decode(round($filas9['saldo'])),1,0,'C',0);
//Fecha de pago planilla 
$pdf->Cell(24, 5, utf8_decode($filas9['fechaPlanilla']),1,0,'C',0);
//Planilla 
 $pdf->Cell(21, 5, utf8_decode($filas9['numPlanilla']),1,0,'C',0);
//Valor Pagado
$pdf->Cell(21, 5, utf8_decode($filas9['valorPlanilla']),1,1,'C',0);
 $pdf->Ln(4);





//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
// add text
$pdf->SetFont('Arial', '', 6);
$pdf->Cell(0, 3, utf8_decode('El supervisor certifica que cumplió,durante el periodo del 24-01-2022 al 23-02-2022 a satisfacción el objeto presente contrato,además que ha revisado lo correspondiente a su afiliación al sistema de '),0,1,'',0);
$pdf->Cell(0, 3, utf8_decode('Seguridad Social y ARL y se encuentra al dia durante el mes de Enero con dichas obligaciones legales. De igual forma certifico que el contratista realizo el respaldo magnetico del informe.'),0,1,'',0);
$pdf->Ln();
//Firmas

//Espacio Supervisor
$pdf->SetFont('Arial','',6);
$pdf->Cell(0, 8, utf8_decode('_______________________'));
$pdf->Ln(5);

 //-----------------------------------------DATOS--------------------------------------------------------
 //Contratista
$pdf->Cell(0, 8, utf8_decode($NombreContratistas));
$pdf->Ln(5);
//-----------------------------------------DATOS2--------------------------------------------------------
//Espacio Contratista
$pdf->Cell(0, 8, utf8_decode('CONTRATISTA'));

/*$pdf->AddPage();
$pdf->SetFont('Arial','B',12);
$current_y = $pdf->GetY();
$current_x = $pdf->GetX();
$cell_width = 12;
$pdf->MultiCell(12,3,'1',1,'C');

$pdf->SetXY($current_x + $cell_width, $current_y );
$pdf->MultiCell(70,10,'	Realizar los trámites administrativos de los procesos jurídicos contractuales que se requieran, en las etapas precontractual, contractual y pos contractual, que adelanta el instituto de desarrollo municipal y su respectiva publicación según lo establecido en la ley',1,'J');

$current_x = $pdf->GetX();
$cell_width = 70 + $cell_width;
$pdf->SetXY($current_x + $cell_width, $current_y);
$pdf->MultiCell(70,10,'	Proyección y revisión de actos administrativos que sean requeridos por el Instituto De Desarrollo Municipal',1,'C');

$current_x = $pdf->GetX();
$cell_width = 70 + $cell_width;
$pdf->SetXY($current_x + $cell_width, $current_y);
$pdf->MultiCell(40, 3, utf8_decode($filas8['ubicacion']), 1, 'J');


$current_y = $pdf->GetY(); 
$current_x = $pdf->GetX();
$cell_width = 12;
$pdf->SetXY($current_x, $current_y * 7.7);
$pdf->MultiCell(12,3,'2',1,'C');

$pdf->SetXY($current_x + $cell_width, $current_y * 7.7 );
$pdf->MultiCell(70,10,'	Realizar los trámites administrativos de los procesos jurídicos contractuales que se requieran, en las etapas precontractual, contractual y pos contractual, que adelanta el instituto de desarrollo municipal y su respectiva publicación según lo establecido en la ley',1,'J');

$current_x = $pdf->GetX();
$cell_width = 70 + $cell_width;
$pdf->SetXY($current_x + $cell_width, $current_y * 7.7 );
$pdf->MultiCell(70,10,'	Proyección y revisión de actos administrativos que sean requeridos por el Instituto De Desarrollo Municipal',1,'C');

$current_x = $pdf->GetX();
$cell_width = 70 + $cell_width;
$pdf->SetXY($current_x + $cell_width, $current_y * 7.7 );
$pdf->MultiCell(40, 3, utf8_decode($filas8['ubicacion']), 1, 'J');

*/

$pdf->Output();



?>