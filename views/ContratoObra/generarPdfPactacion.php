<?php
$idContrato = $_GET["id"];
$NombreContratistas = $_GET["nombre"];
$NombreSupervisor = $_GET["NombreSupervisor"];
$fechaActa = $_GET["fechaActa"];

include('../../db.php');

//extraccion información del contrato
$query= "SELECT * FROM contrato  WHERE contrato.id = $idContrato";
$result = mysqli_query($conexion,$query) or die("fallo en la conexión1");
$row = mysqli_fetch_array($result);

$query2= "SELECT * FROM usuario  WHERE id = $row[idSupervisor]";
$result2 = mysqli_query($conexion,$query2) or die("fallo en la conexión");
$rowSupervisor = mysqli_fetch_array($result2);


//Extraccion de los registros de adiciones y suspensiones
$query3= "SELECT * FROM adicion_suspension WHERE idContrato = $idContrato";
$result3 = mysqli_query($conexion,$query3);


//Extraccion de los alcances
$query4= "SELECT * FROM pactacion WHERE idContrato = $idContrato";
$result4 = mysqli_query($conexion,$query4);


$query5 = "SELECT * FROM usuario  WHERE id = $row[idUsuario]";
$result5 = mysqli_query($conexion, $query5) or die("fallo en la conexión");
$rowContratista = mysqli_fetch_array($result5);



/**
 * Creates an example PDF TEST document using TCPDF
 * @package com.tecnick.tcpdf
 * @abstract TCPDF - Example: Default Header and Footer
 * @author Nicola Asuni
 * @since 2008-03-04
 */

// Include the main TCPDF library (search for installation path).
require_once('TCPDF/examples/tcpdf_include.php');

// create new PDF document
$pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);

// set document information
$pdf->SetCreator(PDF_CREATOR);
$pdf->SetAuthor('Johnson Betancur');
$pdf->SetTitle('Acta Parctacion de Precios');
$pdf->SetSubject('TCPDF Tutorial');
$pdf->SetKeywords('TCPDF, PDF, example, test, guide');

// set default header data
//$pdf->SetHeaderData(PDF_HEADER_LOGO, PDF_HEADER_LOGO_WIDTH, PDF_HEADER_TITLE.' 001', PDF_HEADER_STRING, array(0,64,255), array(0,64,128));
$pdf->setFooterData(array(0,64,0), array(0,64,128));

// set header and footer fonts
//$pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));
$pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));

// set default monospaced font
$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);

// set margins
$pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);
$pdf->SetHeaderMargin(PDF_MARGIN_HEADER);
$pdf->SetFooterMargin(PDF_MARGIN_FOOTER);

// set auto page breaks
$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);

// set image scale factor
$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);

// set some language-dependent strings (optional)
if (@file_exists(dirname(__FILE__).'/lang/eng.php')) {
    require_once(dirname(__FILE__).'/lang/eng.php');
    $pdf->setLanguageArray($l);
}

// ---------------------------------------------------------

// set default font subsetting mode
$pdf->setFontSubsetting(true);

// Set font
// dejavusans is a UTF-8 Unicode font, if you only need to
// print standard ASCII chars, you can use core fonts like
// helvetica or times to reduce file size.
$pdf->SetFont('dejavusans', '', 6, '', true);

// Add a page
// This method has several options, check the source code documentation for more information.
$pdf->AddPage();

// set text shadow effect
$pdf->setTextShadow(array('enabled'=>true, 'depth_w'=>0.2, 'depth_h'=>0.2, 'color'=>array(196,196,196), 'opacity'=>1, 'blend_mode'=>'Normal'));
//

//Logo
 $pdf->Image('../../../public/img/informeActividades.jpg',10,2,200);



//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------


//---------------------------------------------1.Datos Contractuales--------------------------------------------------------------


//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
$informe = "";
$informe .= '<table style="text-align:center;" border="1" cellpadding="2">
                <tr>
                <th width="33%"><strong>Fecha del Acta</strong></th>
                <th width="33%"><strong>Acta N°</strong></th>
                <th width="34%"><strong>Modalidad Contractual</strong></th>
                </tr>
                <tr>
                <td width="33%">'.$fechaActa.'</td>
                <td width="33%">1</td>
                <td style="text-align:left;" width="34%">'.$row['modalidad'].'</td>
                </tr>
             </table><br>';

// Print text using writeHTMLCell()
$pdf->writeHTMLCell(0, 0, '', '', $informe, 0, 1, 0, true, '', true);

$datos = "";
// Set some content to print
$datos .= '

<h2 style="text-align:center">1.Datos Contractuales</h2>
<table style="text-align:center;" border="1" cellpadding="2">
    <tr>
        <th width="25%"><strong>Registro PPTAL</strong></th>
        <th width="25%"><strong>CDP</strong></th>
        <th width="25%"><strong>Año</strong></th>
        <th width="25%"><strong>Contrato N°</strong></th>
    </tr>
    <tr>
        <td width="25%">'.$row['registro_pptal'].'</td>
        <td width="25%">'.$row['disp_presupuestal'].'</td>
        <td width="25%">'.$row['years'].'</td>
        <td width="25%">'.$row['num_contrato'].'</td>
    </tr>

    <!------------------------------------------------------------------------------------->  
    <!-------------------------------------------------------------------------------------> 
    <!-------------------------------------------------------------------------------------> 
    
    <tr>
        <td width="100%"><strong>Rubro</strong></td>
    </tr>
    <tr>
        <td width="100%">'.$row['rubro'].'</td>
    </tr>

    <!------------------------------------------------------------------------------------->  
    <!-------------------------------------------------------------------------------------> 
    <!-------------------------------------------------------------------------------------> 
    
    <tr>
        <td width="37%"><strong>Contratante</strong></td>
        <td width="25%"><strong>Nit</strong></td>
        <td width="38%"><strong>Dirección</strong></td>
    </tr>
    <tr>
        <td width="37%">'.'Empresa de Desarrollo Urbano y Rural de Dosquebras'.'</td>
        <td width="25%">'.'816005795-1'.'</td>
        <td width="38%">'.'Calle 50 NRO 14 -  56 Barrio LOS Naranjos'.'</td>
    </tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!-------------------------------------------------------------------------------------> 
    
<tr>
<td width="37%"><strong>Ordenador del Gasto</strong></td>
<td width="25%"><strong>Ident</strong></td>
<td width="38%"><strong>Cargo</strong></td>
</tr>
<tr>
<td width="37%">'.'CARLOS ALBERTO HENAO OSORIO'.'</td>
<td width="25%">'.'10102159'.'</td>
<td width="38%">'.'Gerente'.'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!------------------------------------------------------------------------------------->
<tr>
<td width="25%"><strong>Interventor</strong></td> 
<td width="15%"><strong>Ident</strong></td>
<td width="20%"><strong>Cargo</strong></td>
<td width="20%"><strong>Fecha Delegación</strong></td>
<td width="20%"><strong>N° Delegación</strong></td>
</tr>
<tr>
<td width="25%">'.$rowSupervisor['nombre'] ." ". $rowSupervisor['apellidos'].'</td> 
<td width="15%">'.$rowSupervisor['cedula'].'</td>
<td width="20%">'.$rowSupervisor['cargo'].'</td>
<td width="20%">'.$row['fecha_delegacion'].'</td>
<td width="20%">'.$row['num_delegacion'].'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!-------------------------------------------------------------------------------------> 
    
<tr>
<td width="25%"><strong>Representante Legal</strong></td>
<td width="15%"><strong>Ident</strong></td>
<td width="20%"><strong>Profesión</strong></td>
<td width="40%"><strong>Dirección</strong></td>
</tr>
<tr>
<td width="25%">'.$NombreContratistas.'</td>
<td width="15%">'.$rowContratista['cedula'].'</td>
<td width="20%">'.$rowContratista['profesion'].'</td>
<td width="40%">'.$rowContratista['direccion'].'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!------------------------------------------------------------------------------------->  

<tr>
<td width="12%"><strong>Tipo de persona</strong></td>
<td width="10%"><strong>Resp de iva</strong></td>
<td width="30%"><strong>Razón Social</strong></td>
<td width="9%"><strong>NIT</strong></td>
<td width="9%"><strong>Telefono</strong></td>
<td width="30%"><strong>Correo</strong></td>
</tr>
<tr>
<td width="12%">'.$rowContratista['tipo_persona'].'</td>
<td width="10%">'.$rowContratista['resp_iva'].'</td>
<td width="30%">'.$rowContratista['razon_social'].'</td>
<td width="9%">'.$rowContratista['nit'].'</td>
<td width="9%">'.$rowContratista['telefono'].'</td>
<td width="30%">'.$rowContratista['correo'].'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!-------------------------------------------------------------------------------------> 


<tr>
<td width="14.%"><strong>Fecha Necesidad</strong></td>
<td width="16%"><strong>Fecha de Inicio</strong></td>
<td width="16%"><strong>Fecha de Fin</strong></td>
<td width="8%"><strong>Duración</strong></td>
<td width="20%"><strong>Valor</strong></td>
<td width="12%"><strong>Anticipo</strong></td>
<td width="14%"><strong>Fecha de Firma</strong></td>
</tr>
<tr>
<td width="14%">'.$row['fecha_necesidad'].'</td>
<td width="16%">'.$row['fecha_ini'].'</td>
<td width="16%">'.$row['fecha_fin'].'</td>
<td width="8%">'.$row['duracion'].'</td>
<td width="20%">'.number_format(intval($row['valor_contrato'])).'</td>
<td width="12%">'.$row['anticipo'].'%</td>
<td width="14%">'.$row['fecha_firma'].'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!------------------------------------------------------------------------------------->  

<tr>
<td style="text-align:left" width="100%"><strong>Objeto: </strong>'.$row['objeto'].'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!-------------------------------------------------------------------------------------> 

<tr>
<td style="text-align:left" width="100%"><strong>Forma de pago: </strong>'.$row['forma_pago'].'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!-------------------------------------------------------------------------------------> 

<tr>
<td style="text-align:left" width="100%"><strong>Entregables: </strong>'.$row['entregables'].'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!-------------------------------------------------------------------------------------> 

<tr>
<td style="text-align:left" width="100%"><strong>Observaciones: </strong>'.$row['observaciones'].'</td>
</tr>

<!------------------------------------------------------------------------------------->  
<!-------------------------------------------------------------------------------------> 
<!-------------------------------------------------------------------------------------> 

</table><br>';


// Print text using writeHTMLCell()
$pdf->writeHTMLCell(0, 0, '', '', $datos, 0, 1, 0, true, '', true);


$sobrecargo = "";
// Set some content to print
$sobrecargo .= '
<table  border ="1" cellpadding="2">
    <tr>
        <th width="9%" align="center"><strong>N° Modificación</strong></th>
        <th width="8%" align="center"><strong>Tipo</strong></th>
        <th width="12%" align="center"><strong>Fecha de modifiación</strong></th>
        <th width="12%" align="center"><strong>Fecha de suspension</strong></th>
        <th width="9%" align="center"><strong>Fecha de reinicio</strong></th>
        <th width="10%" align="center"><strong>Dias</strong></th>
        <th width="10%" align="center"><strong>Valor</strong></th>
        <th width="15%" align="center"><strong>Fecha de terminación Anterior</strong></th>
        <th width="15%" align="center"><strong>Nueva fecha de terminación</strong></th>
    </tr>';
    $cont = 1;
    //while($filas6=mysqli_fetch_array($result6)){
    while($filas3=mysqli_fetch_array($result3)){

        $sobrecargo  .= '<tr>
                    <td align="center">'.$cont.'</td>
                    <td align="center">'.$filas3['tipo'].'</td>';
                    if($filas3['tipo'] == "Suspension"){
                        $sobrecargo .= '<td>'.$filas3['fecha_modificacion'].'</td>
                                        <td>'.$filas3['fecha_suspension'].'</td>
                                        <td>'.$filas3['fecha_reinicio'].'</td>';
                    }else{
                        $sobrecargo .= '<td>NA</td>
                                        <td>NA</td> 
                                        <td>NA</td>'; 
                    }
                    $sobrecargo  .= '
                    <td align="center">'.round($filas3['dias']).'</td>
                    <td>'.number_format(round($filas3['valor']),2,".",",").'</td>
                    <td>'.$filas3['fecha_terminacion_pre'].'</td>
                    <td>'.$filas3['fecha_terminacion_new'].'</td>
                    ';
        $sobrecargo .= '</tr>';
    $cont++;
    }
$sobrecargo .= '</table><br>';


// Print text using writeHTMLCell()
$pdf->writeHTMLCell(0, 0, '', '', $sobrecargo, 0, 1, 0, true, '', true);

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------


//---------------------------------------------3.Pactación de precios--------------------------------------------------------------


//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

$proyeccion = "";
// Set some content to print
$proyeccion  .= '<h2 style="text-align:center">3.Pactación de precios</h2>
<table  border ="1" cellpadding="2">
    <tr>
        <th width="10%" align="center"><strong>Item</strong></th>
        <th width="40%" align="center"><strong>Descripción</strong></th>
        <th width="10%" align="center"><strong>Unidad</strong></th>
        <th width="10%" align="center"><strong>Cantidad</strong></th>
        <th width="15%" align="center"><strong>Valor Parcial</strong></th>
        <th width="15%" align="center"><strong>Total</strong></th>
    </tr>';
    $cont = 1;
    //while($filas6=mysqli_fetch_array($result6)){
    while($filas4=mysqli_fetch_array($result4)){

        $proyeccion  .= '<tr>
                    <td width="10%" align="center">'.$filas4['num_item'].'</td>
                    <td width="40%">'.$filas4['descripcion'].'</td>
                    <td width="10%" align="center">'.$filas4['unidad'].'</td>
                    <td width="10%" align="center">'.$filas4['cantidad'].'</td>
                    <td width="15%" align="center">'.number_format(intval($filas4['valor'])).'</td>
                    <td width="15%" align="center">'.number_format(intval($filas4['valorTotal'])).'</td>
                    </tr>';
        $cont++;
    }
$proyeccion .= '</table><br>';


// Print text using writeHTMLCell()
$pdf->writeHTMLCell(0, 0, '', '', $proyeccion, 0, 1, 0, true, '', true);
// $pdf->AddPage();



//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------

//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------
//--//------------------------------------------------------------------//------------------------------------------------------------


$cumplio = "";
// Set some content to print
$cumplio .= '<div>
<p>Con el fin de realizar la siguiente acta de pactación de precios de items nuevos, ya que en el presupuesto inicial no se consideraron y son de necesaria ejecución para el correcto termino del contrato.
</div><br><br><br><br>';
// Print text using writeHTMLCell()
$pdf->writeHTMLCell(0, 0, '', '', $cumplio , 0, 1, 0, true, '', true);
   //-----------------------------------------DATOS--------------------------------------------------------
//Contratista
//Firmas

//Espacio Supervisor
$pdf->Cell(0, 10, '_______________________________________________');


//Espacio Contratista
$pdf->SetX(85);
$pdf->Cell(0, 10, '_______________________________________________');

//Espacio Gerente
$pdf->SetX(150);
$pdf->Cell(0, 10, '_______________________________________________');
$pdf->Ln(5);

//-----------------------------------------DATOS--------------------------------------------------------
//Supervisor
$pdf->SetFont('dejavusans', 'B', 7, '', true);
$pdf->Cell(0, 10, $NombreContratistas);

//Valor
$pdf->SetX(85);
$pdf->Cell(0, 10, $NombreSupervisor);

//Valor
$pdf->SetX(150);
$pdf->Cell(0, 10, "CARLOS ALBERTO HENAO OSORIO");
$pdf->Ln(5);
//-----------------------------------------DATOS2--------------------------------------------------------
$pdf->SetFont('dejavusans', '', 6, '', true);
$pdf->Cell(0, 10, 'REPRESENTANTE LEGAL');


//Espacio Contratista
$pdf->SetX(85);
$pdf->Cell(0, 10, utf8_decode('INTERVENTOR'));

// Gerente
$pdf->SetX(150);
$pdf->Cell(0, 10, utf8_decode('Gerente'));


 //--//------------------------------------------------------------------////------------------------------------------------------------
//--//------------------------------------------------------------------////------------------------------------------------------------
//--//------------------------------------------------------------------////------------------------------------------------------------
//--//------------------------------------------------------------------////------------------------------------------------------------
//--//------------------------------------------------------------------////------------------------------------------------------------
//--//------------------------------------------------------------------////------------------------------------------------------------



// Close and output PDF document
// This method has several options, check the source code documentation for more information.
$pdf->Output('generarPdfPactacion.pdf', 'I');

//============================================================+
// END OF FILE
//============================================================+


$pdf->Output();



?>